[tool.ruff]
target-version = "py312"
line-length = 120

[tool.ruff.lint]
select = [
    "E",       # pycodestyle errors
    "F",       # pyflakes
    "I",       # isort
    "W",       # pycodestyle warnings
    "B",       # flake8-bugbear
    "S",       # flake8-bandit (security)
    "UP",      # pyupgrade (modern Python idioms)
    "SIM",     # flake8-simplify
    "C4",      # flake8-comprehensions
    "PIE",     # flake8-pie (misc. lint)
    "PLC",     # pylint convention
    "PLE",     # pylint errors
    "PLW",     # pylint warnings
    "ISC",     # flake8-implicit-str-concat
    "A",       # flake8-builtins (shadowing builtins)
    "RET",     # flake8-return
    "LOG",     # flake8-logging
]
ignore = [
    "B008",    # function calls in argument defaults — false positive for FastAPI Depends/File/Form/Header
    "RET505",  # unnecessary else after return — stylistic, not a bug
    "PLW0603", # global statement — intentional in worker.py for _worker_thread
    "PLW1510", # subprocess.run without check — we inspect returncode manually
    "PLC0415", # import not at top-level — intentional lazy imports in worker.py / downloader.py
    "SIM105",  # contextlib.suppress — try/except/pass with comments is clearer for migrations
]

[tool.ruff.lint.per-file-ignores]
# S311: random is fine for non-cryptographic track selection
"api/scheduler.py" = ["S311"]
# S101: assert used for type narrowing after has_file guard
"api/routers/submit.py" = ["S101"]

[tool.ty.environment]
python-version = "3.12"
root = ["api"]
